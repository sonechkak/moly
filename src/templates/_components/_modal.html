<!-- Пригласи друга -->
<div class="modal fade" id="inviteFriendModal" tabindex="-1" aria-labelledby="inviteFriendModalLabel"
     aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Пригласите друзей и получайте бонусы!</p>
                <div class="mb-3">
                    <label for="referralLink" class="form-label">Ваша реферальная ссылка:</label>
                    <div class="input-group">
                        <input type="text" class="form-control" id="referralLink"
                               value="{{ referral_link }}" readonly>
                        <button class="btn btn-primary" type="button" id="copyButton">
                            <i class="bi bi-clipboard"></i> Копировать
                        </button>
                    </div>
                </div>

                <div class="alert alert-success mt-3">
                    Вы получите <strong>100 бонусов</strong> за каждого друга, который зарегистрируется по вашей ссылке!
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Закрыть</button>
                <button type="button" class="btn btn-primary" id="shareButton">
                    <i class="bi bi-share"></i> Поделиться
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    // Показываем модальное окно при загрузке страницы
    document.addEventListener('DOMContentLoaded', function () {
        // Проверяем, нужно ли показывать окно (например, по флагу в контексте)
        if ({{ show_invite_modal|lower }}) {
            var modal = new bootstrap.Modal(document.getElementById('inviteFriendModal'));
            modal.show();
        }

        // Копирование ссылки
        document.getElementById('copyButton').addEventListener('click', function () {
            var copyText = document.getElementById("referralLink");
            copyText.select();
            copyText.setSelectionRange(0, 99999);
            document.execCommand("copy");

            // Меняем текст кнопки временно
            var originalText = this.innerHTML;
            this.innerHTML = '<i class="bi bi-check"></i> Скопировано!';
            setTimeout(() => {
                this.innerHTML = originalText;
            }, 2000);
        });

        // Поделиться ссылкой (Web Share API)
        document.getElementById('shareButton').addEventListener('click', function () {
            if (navigator.share) {
                navigator.share({
                    title: 'Присоединяйся!',
                    text: 'Зарегистрируйся по моей ссылке и получи бонус!',
                    url: document.getElementById('referralLink').value
                }).catch(err => {
                    console.log('Ошибка при использовании Web Share API:', err);
                });
            } else {
                // Fallback для браузеров без поддержки Web Share API
                alert('Ссылка скопирована в буфер обмена!');
                document.getElementById('copyButton').click();
            }
        });
    });
</script>
